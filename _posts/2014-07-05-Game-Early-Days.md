---
layout: default
---

#昔のゲーム開発秘話

(これは、
<a href="http://www.quora.com/Game-Development/How-did-game-developers-pack-entire-games-into-so-little-memory-twenty-five-years-ago" target="_blank">
Quoraのアンサー</a>
の翻訳記事です。)

* Dave Baggettさんは、日本でもヒットしたプレイステーションゲーム "クラッシュバンディクー"開発者コンビのうちの一人です。

これは、1990年後半に起こったエピソード。
私は、当時 クラッシュバンディクーというPlayStation1 用のゲームを、Andy Gavinと一緒につくっていた。

RAM容量は、PS1が出た当時でもとても大きな課題だった。
PS1は2MBのRAMしかなくて、ちょっとやそっとの努力じゃこの壁は乗り越えられなかった。
レベルデータ(訳注: 各ステージごとのデータだと思います)は10MBにもなっていて、ちょっとのローディング遅れも許されなかった。
30Hz以下にフレームレートが落ちると、このローディング遅れが生じる。

どうやってこの一件不可能な状況を乗り切ったかというと、
Andyがすばらしい、本当にすばらしいページングシステムをつくったのが大きい。
クラッシュがステージ内を移動するたびに、64Kのページデータを読み込み直すんだ。
これは、プログラミング/システムの隅から隅までを熟知していたからできた、「神業」だ。

上位レイヤーでのメモリー管理から、メモリー間の機械語でのコーディングまで、それこそ隅から隅までだ。
Andyは、CD-ROM上のバイトの物理的なレイアウトすら考慮に入れていた：毎秒300KBの遅さでしか読み込まないPS1でも、
クラッシュがステージを移動しきるまでにデータ全てを読み込めるようにだ。

私はというと、サウンドや画像、Lispでキャラクターの動きを管理するコードといったリソースを、
Andyが書いたページングシステムにフィットさせるためのパッキングツールをつくっていたよ。
興味深いことに、このパッキングはNP完全問題というやつで、限られた時間で最適化するのは不可能だと証明されている。

64Kに収まったのが奇跡って呼べるようなステージがいくつもあって、そのたびに私が書いたパッキングツールはそれに最適な
アルゴリズムを選択した。First-Fit, Best-Fit... 焼きなまし法で使われるStochastic探索なんてやつも。
要するに、いろいろな収録方法を試してみて、一番結果が良かった（サイズが小さかった）やつが使われるって寸法だ。

こうやって最適化するときの問題点は、また同じ結果が得られるとは限らないってことなんだ。
クラッシュバンディクーのいくつかのステージで、リソースがページ数におさまった唯一の理由が「幸運だったから」なんてこともあった。
これはどういうことかっていうと、もしパッキングした後にコードに変更を加えたいって思ったら、もう一度収まることが期待できないって
ことなんだ。
例えばこんなこともあった。リソースをつくっていたアートスタッフがある変更を加えたいと言い出したんだが、
その変更が、奇跡的に収まっていたリソースサイズをゆうに超える結果になることは明らかだった。
そのために、別のリソースをランダムにパッキングしまくって、なんとかまた収まるようになった。
想像してみてほしい。この説明を、朝の３時に不機嫌顔のアートスタッフにしなきゃいけない場面を。

そんな中でも一番やばかったのは、C/アセンブリコードを、サイズ内に収めることだった。
そのときの自分たち状況は、出荷日に間に合うか間に合わないかの数日前だったよ。
私たちがやったことは、Cで書かれたコードの動きが変えない範囲で、なんどもなんどもサイズが減ることを期待して
コード順番を変えてコンパイルすることだった。
そのとき問題にしていたのは、200,125,50,やがて8バイト小さくしたい、という単位だ。
"for (i=0; i < x; i++)"っていうコードを俎上にあげて、「もしこのfor文を、すでに使用した変数を再利用したwhileループ文にしたらどうだろう？」
みたいな議論になるくらい、私たちは最適化の限りを尽くした後だった。
(もちろん、2バイトの低レイヤーポインタにデータを詰め込むなんてことは、やりきったあとだったよ)

さて、ここで問題だ。
結局、2MBのRAM容量のうち、僕たちはどらくらいを使い切ったと思う？
.
.
.
こたえは、4バイトを残して全部。
そう、2097152バイトあるうちの、4バイトを残して全部使い切った。
.
そう、これがゲーム開発の"古き良き時代"ってやつさ。
